---
classes:
  - amanda::client
  - apache
  - datadog_agent::integrations::http_check
  - loggy
  - blocky
  - gitmirrorupdater
  - ssl::name::wildcard_apache_org
  - ulimit_asf
  - vhosts_asf::vhosts

apache::keepalive:          'On'
apache::keepalive_timeout:  '30'
apache::default_vhost:      false
apache::default_ssl_cert: '/etc/ssl/certs/wildcard.apache.org.crt'
apache::default_ssl_chain: '/etc/ssl/certs/wildcard.apache.org.chain'
apache::default_ssl_key: '/etc/ssl/private/wildcard.apache.org.key'

apache::mod::event::listenbacklog: '511'
apache::mod::event::maxclients: '250'
apache::mod::event::maxconnectionsperchild: '200000'
apache::mod::event::maxrequestworkers: '500'
apache::mod::event::maxsparethreads: '150'
apache::mod::event::minsparethreads: '150'
apache::mod::event::serverlimit: '10'
apache::mod::event::startservers: '5'
apache::mod::event::threadlimit: '250'
apache::mod::event::threadsperchild: '50'

apache::mpm_module:         'event'

datadog_agent::integrations::http_check::url: 'https://git.apache.org'

logrotate::rule:
  apache2:
    ensure: 'present'

postfix::server::mydestination:          "%{::fqdn}, git.apache.org, localhost.%{::domain}, localhost"

vhosts_asf::vhosts::vhosts:
  git:
    vhost_name: '*'
    port: 80
    servername: 'git.apache.org'
    serveradmin: 'infrastructure@apache.org'
    default_vhost: true
    docroot: '/x1/git/mirrors'
    docroot_owner: 'git'
    access_log_file: 'git.apache.org.http_access.log'
    error_log_file: 'git.apache.org.error.log'

  git-ssl:
    vhost_name: '*'
    port: 443
    ssl: true
    servername: 'git.apache.org'
    serveradmin: 'infrastructure@apache.org'
    default_vhost: true
    docroot: '/x1/git/mirrors'
    docroot_owner: 'git'
    access_log_file: 'git.apache.org.ssl_access.log'
    error_log_file: 'git.apache.org.error.log'
